---
title: "SEA_AD"
subtitle: 'SEA_AD'
author: "Developed by [Gabriel Hoffman](http://gabrielhoffman.github.io/)"
date: "Run on `r Sys.time()`"
documentclass: article
output: 
  html_document:
    toc: true
    smart: false
vignette: >
  %\VignetteIndexEntry{SEA_AD}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  %\usepackage[utf8]{inputenc}
---





<!--- 

cd /sc/arion/projects/CommonMind/hoffman/NPS-AD/work/nps_ad/replication/SEA_AD
R
rmarkdown::render("SEA_AD.Rmd");

FILE=/sc/arion/projects/CommonMind/leed62/ref/published/2024_SEA-AD_snRNA/SEAAD_A9_RNAseq_final-nuclei.2024-02-13.h5ad
../../../nps_ad/concat_h5ad.py -i <(echo $FILE) -d -o SEAAD_A9_RNAseq_final.h5ad

# https://hoffmg01.u.hpc.mssm.edu/dreamlet_analysis/Mathys_2023/Mathys_2023_Major_Cell_Type.html


export R_LIBS_USER=
export R_LIBS=
# /sc/arion/projects/CommonMind/leed62/conda/envs/dreamlet430/bin/R --vanilla --quiet
.libPaths("/sc/arion/projects/CommonMind/leed62/conda/envs/dreamlet430/lib/R/library")

, obsm=FALSE, obsp=FALSE, uns=FALSE, var=FALSE,

--->



```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning=FALSE,
  message=FALSE,
  error = FALSE,
  tidy = FALSE,
  dev = c("png", "pdf"),
  cache = TRUE,
  cache.lazy = FALSE)
```

# Load packages
```{r load.packages, cache=FALSE}
library(SingleCellExperiment)
library(zellkonverter)
library(DelayedArray)
library(dreamlet)
library(scater)
library(GSEABase)
library(zenith)
library(ggrepel)
library(knitr)
library(kableExtra)
library(scattermore)
library(cowplot)
library(ggplot2)
library(viridis)
library(qvalue)
library(tidyverse)
library(RColorBrewer)
library(BiocParallel)
library(arrow)
library(formula.tools)
```


# Load data
```{r load.data}
# read H5AD file
# file = "/sc/arion/projects/CommonMind/leed62/ref/published/2024_SEA-AD_snRNA/SEAAD_A9_RNAseq_final-nuclei.2024-02-13.h5ad"
# sce = readH5AD(file, use_hdf5=TRUE, verbose=TRUE, layers=TRUE, version="0.8.0", reader="R")
sce = readRDS("/sc/arion/projects/psychAD/NPS-AD/freeze2_proc/241202_PsychAD_external_validations/241202_SEA-AD.sce.rds")

# create pseudobulk 
pb <- aggregateToPseudoBulk(sce,
    assay = "counts",     
    cluster_id = "Subclass",  
    sample_id = "Donor.ID")
```

form = ~ Sex + Age.at.Death + PMI + Brain.pH












